<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tournament Subscriptions</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">

  <!-- Current User -->
  <div class="mb-6">
    <input type="text" id="currentUser" class="p-2 border rounded w-64" placeholder="Enter your name (current user)" />
  </div>

  <div class="flex gap-6">
    <!-- Tournament List -->
    <div class="w-1/4 bg-white p-4 rounded-2xl shadow">
      <h2 class="text-xl font-bold mb-4">Tournaments</h2>
      <ul id="tournamentList" class="space-y-2"></ul>

      <!-- Create Tournament -->
      <form id="createTournamentForm" class="mt-6">
        <input type="text" id="tournamentName" class="w-full p-2 border rounded mb-2" placeholder="New Tournament" required />
        <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">Create</button>
      </form>
    </div>

    <!-- Tournament Details -->
    <div class="flex-1 bg-white p-4 rounded-2xl shadow">
      <h2 class="text-xl font-bold mb-4" id="selectedTournamentTitle">Select a tournament</h2>
      <p id="statusMessage" class="mb-4 text-sm text-gray-600"></p>
      <ul id="playerList" class="space-y-2 mb-4"></ul>

      <div class="flex gap-4">
        <button id="subscribeBtn" class="bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600 hidden">Subscribe</button>
        <button id="startBtn" class="bg-purple-500 text-white py-2 px-4 rounded hover:bg-purple-600 hidden">Start Tournament</button>
      </div>
    </div>
  </div>

  <script>
    const tournaments = {};
    let selectedTournament = null;

    const currentUserInput = document.getElementById('currentUser');
    const tournamentList = document.getElementById('tournamentList');
    const createTournamentForm = document.getElementById('createTournamentForm');
    const tournamentNameInput = document.getElementById('tournamentName');

    const selectedTitle = document.getElementById('selectedTournamentTitle');
    const playerList = document.getElementById('playerList');
    const subscribeBtn = document.getElementById('subscribeBtn');
    const startBtn = document.getElementById('startBtn');
    const statusMessage = document.getElementById('statusMessage');

    createTournamentForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = tournamentNameInput.value.trim();
      const creator = currentUserInput.value.trim();

      if (!creator) {
        alert("Please enter your name as the current user.");
        return;
      }

      if (name && !tournaments[name]) {
        tournaments[name] = {
          creator,
          players: [],
          started: false
        };
        addTournamentToList(name);
        tournamentNameInput.value = '';
      } else {
        alert('Tournament already exists or invalid name.');
      }
    });

    function addTournamentToList(name) {
      const li = document.createElement('li');
      li.textContent = name;
      li.className = 'cursor-pointer p-2 hover:bg-gray-100 rounded';
      li.addEventListener('click', () => selectTournament(name));
      tournamentList.appendChild(li);
    }

    function selectTournament(name) {
      selectedTournament = name;
      const tournament = tournaments[name];
      selectedTitle.textContent = `Players in "${name}"`;

      renderPlayers();

      const currentUser = currentUserInput.value.trim();
      const isCreator = tournament.creator === currentUser;

      // Show "Start Tournament" if current user is the creator and it's not started yet
      if (isCreator && !tournament.started) {
        startBtn.classList.remove('hidden');
      } else {
        startBtn.classList.add('hidden');
      }

      // Show or hide "Subscribe" button
      if (currentUser && !tournament.players.includes(currentUser) && !tournament.started) {
        subscribeBtn.classList.remove('hidden');
      } else {
        subscribeBtn.classList.add('hidden');
      }

      // Show tournament status
      statusMessage.textContent = tournament.started
        ? "🏁 This tournament has started."
        : `Creator: ${tournament.creator}`;
    }

    function renderPlayers() {
      playerList.innerHTML = '';
      const players = tournaments[selectedTournament]?.players || [];

      players.forEach(player => {
        const li = document.createElement('li');
        li.textContent = player;
        li.className = 'border p-2 rounded';
        playerList.appendChild(li);
      });
    }

    subscribeBtn.addEventListener('click', () => {
      const user = currentUserInput.value.trim();
      if (!user) {
        alert('Please enter your name at the top.');
        return;
      }

      const tournament = tournaments[selectedTournament];
      if (tournament && !tournament.players.includes(user)) {
        tournament.players.push(user);
        renderPlayers();
        subscribeBtn.classList.add('hidden');
      }
    });

    startBtn.addEventListener('click', () => {
      const tournament = tournaments[selectedTournament];
      if (tournament && !tournament.started) {
        tournament.started = true;
        statusMessage.textContent = "🏁 This tournament has started.";
        startBtn.classList.add('hidden');
        subscribeBtn.classList.add('hidden');
      }
    });
  </script>
</body>
</html>